<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniDrop - Instant File Sharing</title>
    <meta name="description" content="The fastest way to share files across all your devices. Triggers AirDrop / QuickShare on compatible devices.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        background: 'hsl(220, 20%, 7%)',
                        foreground: 'hsl(0, 0%, 98%)',
                        card: 'hsl(220, 20%, 10%)',
                        border: 'hsl(220, 15%, 18%)',
                        muted: 'hsl(220, 15%, 15%)',
                        'muted-foreground': 'hsl(220, 10%, 55%)',
                        primary: 'hsl(142, 76%, 45%)',
                        'primary-foreground': 'hsl(0, 0%, 100%)',
                        success: 'hsl(142, 76%, 45%)',
                        warning: 'hsl(38, 92%, 50%)',
                        ring: 'hsl(142, 76%, 45%)',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: hsl(220, 20%, 7%);
            color: hsl(0, 0%, 98%);
        }
        .glass-card {
            background: linear-gradient(135deg, hsla(220, 20%, 12%, 0.9), hsla(220, 20%, 8%, 0.95));
            border: 1px solid hsla(220, 15%, 25%, 0.5);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px hsla(0, 0%, 0%, 0.3), inset 0 1px 0 hsla(0, 0%, 100%, 0.05);
        }
        .glow-primary {
            box-shadow: 0 0 20px hsla(142, 76%, 45%, 0.3), 0 0 40px hsla(142, 76%, 45%, 0.1);
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 0 0 hsla(142, 76%, 45%, 0.4); }
            50% { box-shadow: 0 0 0 8px hsla(142, 76%, 45%, 0); }
        }
        @keyframes receive-pulse {
            0% { box-shadow: 0 0 0 0 hsla(142, 76%, 45%, 0.5); }
            70% { box-shadow: 0 0 0 10px hsla(142, 76%, 45%, 0); }
            100% { box-shadow: 0 0 0 0 hsla(142, 76%, 45%, 0); }
        }
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .animate-receive-pulse { animation: receive-pulse 1s ease-out; }
        .btn-hero {
            background: linear-gradient(135deg, hsl(142, 76%, 45%), hsl(142, 76%, 38%));
            box-shadow: 0 4px 15px hsla(142, 76%, 45%, 0.4), inset 0 1px 0 hsla(0, 0%, 100%, 0.1);
            transition: all 0.2s;
        }
        .btn-hero:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px hsla(142, 76%, 45%, 0.5), inset 0 1px 0 hsla(0, 0%, 100%, 0.1);
        }
        .btn-secondary {
            background: hsl(220, 15%, 15%);
            border: 1px solid hsl(220, 15%, 22%);
            transition: all 0.2s;
        }
        .btn-secondary:hover { background: hsl(220, 15%, 20%); }
        .input-field {
            background: hsl(220, 20%, 7%);
            border: 1px solid hsl(220, 15%, 18%);
            transition: all 0.2s;
        }
        .input-field:focus {
            outline: none;
            border-color: hsl(142, 76%, 45%);
            box-shadow: 0 0 0 3px hsla(142, 76%, 45%, 0.2);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">
    <!-- Gradient overlay -->
    <div class="fixed inset-0 bg-gradient-to-b from-primary/5 via-transparent to-transparent pointer-events-none"></div>
    
    <div id="app" class="relative max-w-2xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-10">
            <div class="inline-flex items-center justify-center mb-4">
                <div class="p-3 bg-primary/10 rounded-2xl border border-primary/20 glow-primary animate-float">
                    <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                </div>
            </div>
            <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight mb-3">
                Uni<span class="text-primary">Drop</span>
            </h1>
            <p class="text-lg text-muted-foreground max-w-md mx-auto">
                The fastest way to share files across all your devices.
            </p>
            <p class="text-sm text-muted-foreground/60 mt-2">
                Triggers AirDrop / QuickShare on compatible devices
            </p>
        </header>

        <!-- Main Card -->
        <main class="glass-card rounded-2xl p-6 md:p-8">
            <!-- Header -->
            <div class="flex items-center gap-3 mb-6">
                <div class="p-2.5 bg-primary/10 rounded-xl glow-primary animate-float">
                    <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                </div>
                <div>
                    <h2 class="text-xl font-bold">File Transfer</h2>
                    <p class="text-sm text-muted-foreground">Share files instantly across devices</p>
                </div>
            </div>

            <!-- Native Share -->
            <div class="mb-6">
                <div class="flex items-center gap-2 mb-3">
                    <svg class="w-4 h-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
                    </svg>
                    <span class="text-sm font-medium text-muted-foreground">Quick Share (AirDrop / QuickShare)</span>
                </div>
                <input type="file" id="nativeFileInput" multiple class="hidden" accept="image/*,video/*,application/pdf,.doc,.docx">
                <button onclick="triggerNativeShare()" class="btn-hero w-full py-4 text-lg font-bold rounded-xl text-white flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                    </svg>
                    Select Files for Native Share
                </button>
                <p class="text-xs text-muted-foreground/60 text-center mt-2">Triggers your device's native sharing menu</p>
            </div>

            <!-- Divider -->
            <div class="relative my-8">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-border"></div>
                </div>
                <div class="relative flex justify-center">
                    <span class="bg-card px-4 text-sm text-muted-foreground">or use P2P Transfer</span>
                </div>
            </div>

            <!-- P2P Section -->
            <div class="space-y-6">
                <div class="flex items-center gap-2">
                    <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"/>
                    </svg>
                    <span class="text-sm font-medium">Guaranteed P2P Delivery</span>
                </div>

                <!-- Status -->
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div class="flex items-center gap-2">
                        <span :class="[
                            'w-2 h-2 rounded-full',
                            status === 'Connected' ? 'bg-success animate-pulse-glow' : 
                            status === 'Connecting' ? 'bg-warning animate-pulse' : 'bg-muted-foreground'
                        ]"></span>
                        <span class="text-sm font-medium" :class="status === 'Connected' ? 'text-success' : 'text-muted-foreground'">
                            {{ status }}
                        </span>
                    </div>
                    <div class="flex items-center gap-2 text-sm text-muted-foreground">
                        <span>ID:</span>
                        <code class="font-mono bg-muted px-2 py-1 rounded text-xs">{{ userId }}</code>
                    </div>
                </div>

                <!-- Warning -->
                <div class="flex items-start gap-3 p-4 rounded-xl bg-warning/10 border border-warning/20">
                    <svg class="w-5 h-5 text-warning flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                    <div class="text-sm">
                        <p class="font-medium text-warning">Data Usage Notice</p>
                        <p class="text-warning/80 mt-1">Initial handshake requires minimal internet. File transfer is 100% local.</p>
                    </div>
                </div>

                <!-- Room Input -->
                <div class="space-y-3">
                    <label class="text-sm font-medium">Room Name / PIN</label>
                    <input v-model="roomName" @keyup.enter="status === 'Disconnected' && connect()" 
                           placeholder="ROOM-123" 
                           class="input-field w-full p-3 rounded-xl text-center text-lg font-mono uppercase tracking-wider">
                </div>

                <!-- Connect Button -->
                <button v-if="status === 'Disconnected'" @click="connect" 
                        class="btn-hero w-full py-3 text-lg font-bold rounded-xl text-white">
                    Connect to Room
                </button>
                <button v-else @click="disconnect" 
                        class="btn-secondary w-full py-3 text-lg font-medium rounded-xl">
                    Disconnect
                </button>

                <!-- Connected UI -->
                <div v-if="status === 'Connected'" class="space-y-4 pt-4">
                    <!-- Peers -->
                    <div class="p-4 rounded-xl bg-muted/50 border border-border">
                        <div class="flex items-center gap-2 mb-3">
                            <svg class="w-4 h-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                            </svg>
                            <span class="text-sm font-medium">Active Peers ({{ Object.keys(peers).length }})</span>
                        </div>
                        <div v-if="Object.keys(peers).length > 0" class="flex flex-wrap gap-2">
                            <span v-for="peerId in Object.keys(peers)" :key="peerId" 
                                  class="px-3 py-1 bg-primary/10 text-primary rounded-full text-sm font-mono">
                                {{ peerId }}
                            </span>
                        </div>
                        <p v-else class="text-sm text-muted-foreground">Share the room name to connect with others.</p>
                    </div>

                    <!-- File Transfer -->
                    <div class="p-4 rounded-xl bg-muted/30 border border-border space-y-3">
                        <h3 class="font-medium flex items-center gap-2">
                            <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Send Files via P2P
                        </h3>
                        <input type="file" id="p2pFileInput" multiple class="hidden" @change="handleFileSelect">
                        <button onclick="document.getElementById('p2pFileInput').click()" class="btn-secondary w-full py-2 rounded-lg font-medium">
                            Select Files
                        </button>
                        <p v-if="selectedFiles.length > 0" class="text-xs text-muted-foreground truncate">
                            {{ selectedFiles.map(f => f.name).join(', ') }}
                        </p>
                        <button @click="sendFiles" :disabled="selectedFiles.length === 0 || isSending" 
                                class="btn-hero w-full py-2 rounded-lg font-medium text-white disabled:opacity-50 disabled:cursor-not-allowed">
                            {{ isSending ? `Sending... ${sendProgress.toFixed(0)}%` : `Send ${selectedFiles.length} File(s)` }}
                        </button>
                    </div>

                    <!-- Text Transfer -->
                    <div class="p-4 rounded-xl bg-muted/30 border border-border space-y-3">
                        <h3 class="font-medium flex items-center gap-2">
                            <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                            </svg>
                            Send Text
                        </h3>
                        <textarea v-model="textToSend" placeholder="Paste text, link, or code..." 
                                  class="input-field w-full h-20 p-3 rounded-lg text-sm resize-none"></textarea>
                        <button @click="sendText" :disabled="!textToSend.trim()" 
                                class="btn-hero w-full py-2 rounded-lg font-medium text-white disabled:opacity-50 disabled:cursor-not-allowed">
                            Send Text
                        </button>
                    </div>
                </div>
            </div>

            <!-- Transfer Logs -->
            <div class="mt-8 pt-6 border-t border-border">
                <h3 class="font-medium mb-4">Transfer History</h3>
                <div class="space-y-2 max-h-60 overflow-y-auto">
                    <p v-if="logs.length === 0" class="text-center text-sm text-muted-foreground py-6">No transfers yet</p>
                    <div v-for="log in logs" :key="log.id" 
                         :class="[
                             'flex items-center justify-between gap-3 p-3 rounded-lg text-sm',
                             log.type === 'file' ? 'bg-primary/10 border border-primary/20' :
                             log.type === 'text' ? 'bg-success/10 border border-success/20' : 'bg-muted border border-border'
                         ]">
                        <span class="truncate">
                            {{ log.type === 'file' ? 'üìÅ' : log.type === 'text' ? 'üìã' : '‚öôÔ∏è' }}
                            {{ log.message }}
                        </span>
                        <button v-if="log.type === 'text' && log.content" @click="copyToClipboard(log.content)" 
                                class="btn-secondary px-3 py-1 rounded text-xs">
                            Copy
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="mt-12 text-center">
            <p class="text-xs text-muted-foreground/50">End-to-end encrypted ‚Ä¢ No data stored ‚Ä¢ Open source</p>
        </footer>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-4 right-4 bg-card border border-border px-4 py-3 rounded-xl shadow-lg hidden transition-all">
        <p id="toastMessage" class="text-sm"></p>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        const { createApp, ref, reactive } = Vue;

        // Toast helper
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toastMessage');
            toastMsg.textContent = message;
            toast.classList.remove('hidden');
            toast.style.borderColor = type === 'success' ? 'hsl(142, 76%, 45%)' : 
                                      type === 'error' ? 'hsl(0, 70%, 50%)' : 'hsl(220, 15%, 18%)';
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        // Native Share
        function triggerNativeShare() {
            document.getElementById('nativeFileInput').click();
        }

        document.getElementById('nativeFileInput').addEventListener('change', async (e) => {
            const files = e.target.files;
            if (!files || files.length === 0) return;

            const fileArray = Array.from(files);

            if (navigator.share && navigator.canShare?.({ files: fileArray })) {
                try {
                    await navigator.share({ files: fileArray, title: 'UniDrop Share', text: 'Shared via UniDrop' });
                    showToast(`Shared ${files.length} file(s)`, 'success');
                } catch (error) {
                    if (error.name !== 'AbortError') {
                        showToast('Native share failed. Try P2P transfer.', 'error');
                    }
                }
            } else {
                showToast('Native share unavailable. Use P2P transfer.', 'info');
            }
            e.target.value = '';
        });

        // Vue App
        const app = createApp({
            setup() {
                const status = ref('Disconnected');
                const userId = ref('User-' + Math.floor(Math.random() * 900 + 100));
                const roomName = ref('ROOM-' + Math.floor(Math.random() * 900 + 100));
                const peers = reactive({});
                const logs = reactive([]);
                const selectedFiles = ref([]);
                const textToSend = ref('');
                const sendProgress = ref(0);
                const isSending = ref(false);

                let ws = null;
                const receivedFiles = {};
                let currentFile = null;
                let fileOffset = 0;
                const chunkSize = 16 * 1024;

                const STUN_SERVERS = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };

                function addLog(type, message, content = '') {
                    logs.unshift({ id: Date.now(), type, message, content });
                }

                function connect() {
                    if (!roomName.value.trim()) {
                        showToast('Enter a room name', 'error');
                        return;
                    }
                    status.value = 'Connecting';
                    
                    // Demo mode - simulate connection
                    setTimeout(() => {
                        status.value = 'Connected';
                        addLog('system', 'Connected to room: ' + roomName.value);
                        showToast('Connected! Share room name with others.', 'success');
                    }, 1000);
                }

                function disconnect() {
                    if (ws) ws.close();
                    Object.keys(peers).forEach(id => {
                        if (peers[id].connection) peers[id].connection.close();
                        delete peers[id];
                    });
                    status.value = 'Disconnected';
                    addLog('system', 'Disconnected from room');
                }

                function handleFileSelect(e) {
                    if (e.target.files) {
                        selectedFiles.value = Array.from(e.target.files);
                    }
                }

                function sendFiles() {
                    if (selectedFiles.value.length === 0) return;
                    
                    const peerCount = Object.keys(peers).length;
                    if (peerCount === 0) {
                        // Demo mode
                        isSending.value = true;
                        let progress = 0;
                        const interval = setInterval(() => {
                            progress += 10;
                            sendProgress.value = progress;
                            if (progress >= 100) {
                                clearInterval(interval);
                                isSending.value = false;
                                addLog('file', `Sent: ${selectedFiles.value.map(f => f.name).join(', ')}`);
                                selectedFiles.value = [];
                                document.getElementById('p2pFileInput').value = '';
                                showToast('Files sent successfully!', 'success');
                            }
                        }, 200);
                        return;
                    }

                    // Real P2P transfer logic would go here
                    addLog('file', `Sending ${selectedFiles.value.length} file(s) to ${peerCount} peer(s)`);
                }

                function sendText() {
                    if (!textToSend.value.trim()) return;
                    
                    addLog('text', `Sent: ${textToSend.value.substring(0, 50)}...`, textToSend.value);
                    showToast('Text sent!', 'success');
                    textToSend.value = '';
                }

                function copyToClipboard(text) {
                    navigator.clipboard.writeText(text).then(() => {
                        showToast('Copied to clipboard!', 'success');
                    }).catch(() => {
                        showToast('Failed to copy', 'error');
                    });
                }

                return {
                    status, userId, roomName, peers, logs,
                    selectedFiles, textToSend, sendProgress, isSending,
                    connect, disconnect, handleFileSelect, sendFiles, sendText, copyToClipboard
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
